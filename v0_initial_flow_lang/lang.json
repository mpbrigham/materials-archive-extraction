{
  "description": "Materials Archive Extraction Pipeline - Email to JSON",
  "name": "Materials Extraction Flow",
  "id": "materials-extraction-v1",
  "data": {
    "nodes": [
      {
        "id": "email-trigger",
        "type": "EmailTrigger",
        "position": { "x": 100, "y": 200 },
        "data": {
          "imap_host": "{{IMAP_HOST}}",
          "imap_port": "{{IMAP_PORT}}",
          "email": "{{EMAIL_USER}}",
          "password": "{{EMAIL_PASS}}",
          "folder": "INBOX",
          "mark_as_read": true,
          "delete_after_reading": false,
          "check_interval": 60
        }
      },
      {
        "id": "pdf-extractor",
        "type": "DocumentLoader",
        "position": { "x": 300, "y": 200 },
        "data": {
          "file_type": "pdf",
          "extract_images": true,
          "max_file_size_mb": 50
        }
      },
      {
        "id": "prompt-loader",
        "type": "TextLoader",
        "position": { "x": 300, "y": 350 },
        "data": {
          "file_path": "/app/prompts/llm_extraction.txt"
        }
      },
      {
        "id": "schema-loader",
        "type": "JSONLoader",
        "position": { "x": 300, "y": 450 },
        "data": {
          "file_path": "/app/schema/materials_schema.json"
        }
      },
      {
        "id": "gemini-extractor",
        "type": "GoogleGenerativeAI",
        "position": { "x": 500, "y": 200 },
        "data": {
          "model": "{{LLM_MODEL}}",
          "api_key": "{{LLM_API_KEY}}",
          "temperature": 0.1,
          "max_tokens": 8192,
          "response_format": "json_object"
        }
      },
      {
        "id": "json-validator",
        "type": "JSONValidator",
        "position": { "x": 700, "y": 200 },
        "data": {
          "validate_against_schema": true,
          "fix_common_errors": true
        }
      },
      {
        "id": "response-formatter",
        "type": "TextFormatter",
        "position": { "x": 900, "y": 200 },
        "data": {
          "format": "email_html",
          "success_template": "/app/email_templates/success.html",
          "failure_template": "/app/email_templates/failure.html"
        }
      },
      {
        "id": "email-sender",
        "type": "EmailSender",
        "position": { "x": 1100, "y": 200 },
        "data": {
          "smtp_host": "{{SMTP_HOST}}",
          "smtp_port": "{{SMTP_PORT}}",
          "email": "{{EMAIL_USER}}",
          "password": "{{EMAIL_PASS}}",
          "reply_to_sender": true,
          "subject_prefix": "Re: Materials Extraction - "
        }
      }
    ],
    "edges": [
      {
        "id": "e1",
        "source": "email-trigger",
        "target": "pdf-extractor",
        "sourceHandle": "attachments",
        "targetHandle": "input"
      },
      {
        "id": "e2",
        "source": "pdf-extractor",
        "target": "gemini-extractor",
        "sourceHandle": "text",
        "targetHandle": "document"
      },
      {
        "id": "e3",
        "source": "prompt-loader",
        "target": "gemini-extractor",
        "sourceHandle": "text",
        "targetHandle": "system_prompt"
      },
      {
        "id": "e4",
        "source": "gemini-extractor",
        "target": "json-validator",
        "sourceHandle": "response",
        "targetHandle": "input"
      },
      {
        "id": "e5",
        "source": "schema-loader",
        "target": "json-validator",
        "sourceHandle": "schema",
        "targetHandle": "schema"
      },
      {
        "id": "e6",
        "source": "json-validator",
        "target": "response-formatter",
        "sourceHandle": "validated",
        "targetHandle": "data"
      },
      {
        "id": "e7",
        "source": "response-formatter",
        "target": "email-sender",
        "sourceHandle": "formatted",
        "targetHandle": "body"
      },
      {
        "id": "e8",
        "source": "email-trigger",
        "target": "email-sender",
        "sourceHandle": "sender_email",
        "targetHandle": "recipient"
      },
      {
        "id": "e9",
        "source": "email-trigger",
        "target": "response-formatter",
        "sourceHandle": "original_subject",
        "targetHandle": "subject"
      }
    ]
  },
  "components": {
    "email_monitoring": {
      "type": "IMAP",
      "polling_interval": 60,
      "error_handling": "retry_with_backoff"
    },
    "pdf_processing": {
      "max_pages": 100,
      "ocr_enabled": true,
      "language": "en"
    },
    "llm_configuration": {
      "retry_on_rate_limit": true,
      "timeout": 120,
      "fallback_model": "gemini-1.5-flash"
    },
    "response_handling": {
      "include_confidence_scores": true,
      "include_processing_summary": true,
      "attach_json_file": true
    }
  },
  "error_handling": {
    "on_pdf_error": "send_failure_email",
    "on_llm_error": "send_failure_email",
    "on_validation_error": "send_partial_results",
    "on_email_error": "log_and_retry"
  },
  "environment_variables": [
    "IMAP_HOST",
    "IMAP_PORT", 
    "SMTP_HOST",
    "SMTP_PORT",
    "EMAIL_USER",
    "EMAIL_PASS",
    "LLM_API_KEY",
    "LLM_MODEL"
  ]
}
