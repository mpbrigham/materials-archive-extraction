{
  "name": "Materials Extraction Pipeline",
  "nodes": [
    {
      "parameters": {
        "format": "resolved",
        "options": {}
      },
      "id": "7e3143d2-a805-4988-a852-1a9e99001329",
      "name": "Email Trigger",
      "type": "n8n-nodes-base.emailReadImap",
      "typeVersion": 2,
      "position": [
        -32,
        -160
      ],
      "credentials": {
        "imap": {
          "id": "h0Vity66wkDfDonL",
          "name": "IMAP account"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "http://python-api:8000/validate",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ { email_context: $json, attachments: $json.attachments } }}",
        "options": {}
      },
      "id": "1295579e-41be-434b-9a17-3322a77afe96",
      "name": "Document Validator",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        336,
        -160
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "http://python-api:8000/extract",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ [$json] }}",
        "options": {}
      },
      "id": "02dc3149-dc68-4758-975e-d02f58a2544d",
      "name": "LLM Extraction",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        512,
        -160
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "http://python-api:8000/process",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ [$json] }}",
        "options": {}
      },
      "id": "d2ff04d4-6793-421b-8ef7-ee5081bd4355",
      "name": "Result Processor",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        736,
        -160
      ]
    },
    {
      "parameters": {
        "fromEmail": "={{ $json.from }}",
        "toEmail": "={{ $json.to }}",
        "subject": "={{ $json.subject }}",
        "emailFormat": "html",
        "html": "={{ $json.body }}",
        "options": {}
      },
      "id": "495e47d9-5a89-43be-bff6-862ccb024b01",
      "name": "Send Notification",
      "type": "n8n-nodes-base.emailSend",
      "typeVersion": 2,
      "position": [
        944,
        -160
      ],
      "webhookId": "f2078588-7a6e-4e6e-8a59-037efbe2ab58",
      "credentials": {
        "smtp": {
          "id": "l29wKFfdODrn2qgi",
          "name": "SMTP account"
        }
      }
    },
    {
      "parameters": {
        "code": "const emailContext = { ...item.json };\nconst attachments = [];\n\nfor (const [attachmentKey, attachment] of Object.entries(item.binary || {})) {\n  attachments.push({\n    fileName: attachment.fileName,\n    mimeType: attachment.mimeType,\n    fileSize: attachment.data.length,\n    data: attachment.data\n  });\n}\n\nreturn [\n  {\n    json: {\n      ...emailContext,\n      attachments\n    }\n  }\n];"
      },
      "name": "Convert Binary to JSON",
      "type": "n8n-nodes-base.code",
      "typeVersion": 1,
      "position": [200, -160]
    }
  ],
  "pinData": {},
  "connections": {
    "Email Trigger": {
      "main": [
        [
          {
            "node": "Convert Binary to JSON",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Convert Binary to JSON": {
      "main": [
        [
          {
            "node": "Document Validator",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Document Validator": {
      "main": [
        [
          {
            "node": "LLM Extraction",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "LLM Extraction": {
      "main": [
        [
          {
            "node": "Result Processor",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Result Processor": {
      "main": [
        [
          {
            "node": "Send Notification",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "ecdec93a-e99c-4bd1-8e7f-3b8df04cc429",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "05d627df821b57811f26946d0226002bbfd9dcbcaa7902e0c982270490489431"
  },
  "id": "je2uy7uN1VG30e2S",
  "tags": []
}
