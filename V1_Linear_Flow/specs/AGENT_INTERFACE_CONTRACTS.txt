# AGENT INTERFACE CONTRACTS (V1)

1. Supervisor → Multimodal Extraction Agent
{
  "file_path": "...",
  "sender": "...",
  "timestamp": "...",
  "subject": "...",
  "language": "en" | "nl" | "de",
  "retry_count": 0 | 1 | 2,
  "multimodal_processing": true
}

2. Multimodal Extraction Agent → LLM Data Processor
{
  "metadata_json": { ... },
  "field_extractions": {
    "field1": {
      "value": "...",
      "location": { "page": 1, "bbox": [x1, y1, x2, y2] },
      "confidence": 0.95
    },
    ...
  },
  "field_confidences": {
    "field1": 0.95,
    "field2": 0.87,
    ...
  },
  "_metadata": {
    "prompt_id": "multimodal-v1.5",
    "model_version": "gemini-pro-vision",
    "generated_ts": "<iso8601>",
    "is_retry": true | false,
    "retry_count": 0 | 1 | 2,
    "multimodal_extraction": true,
    "source_file_name": "..."
  }
}

3. LLM Data Processor → Multimodal Verifier (PROCEED/FALLBACK paths)
{
  "metadata_json": { ... },
  "llm_decision": "PROCEED" | "FALLBACK",
  "confidence": 0.0-1.0,
  "fallback_applied": true | false,
  "processor_notes": "Notes about the processing decision",
  "field_locations": { ... },
  "field_confidences": { ... }
}

4. LLM Data Processor → Supervisor (FAIL path)
{
  "task_status": "failed",
  "error_summary": "...",
  "document_id": "...",
  "_lifecycle_log": [ ... ]
}

5. Multimodal Verifier → Response Formatter
{
  "verification_passed": true | false,
  "cleaned_json": { ... },
  "reason": "...",
  "verification_results": {
    "verified_fields": ["name", "brand", ...],
    "unverified_fields": ["certifications", ...],
    "evidence": {
      "name": { 
        "page": 1, 
        "location": "header", 
        "verified": true,
        "confidence": 0.98
      },
      ...
    },
    "mvs_verification": {
      "passed": true | false,
      "confidence": 0.97,
      "notes": "..."
    }
  },
  "verifier_version": "multimodal-v1.5",
  "fallback_applied": true | false
}